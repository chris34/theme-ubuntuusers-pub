/**
 * Inyoka ubuntuusers.de theme
 * 2015-01-03 17:12:45
 * https://github.com/inyokaproject/theme-ubuntuusers
 * :copyright: (c) 2007-2015 by the Inyoka Team
 * :license: BSD
 */
!function(){function a(a){return a%4===0&&a%100!==0||a%400===0}function b(b,c){var d;return d=-1!=$.inArray(b,[1,3,5,7,8,10,12])?31:-1!=$.inArray(b,[4,6,9,11])?30:2==b&&a(c)?29:28}var c=["Januar","Februar","März","April","Mai","Juni","Juli","August","September","Oktober","November","Dezember"],d=["S","M","D","M","D","F","S"];DateTimeField=Class.$extend({__init__:function(a,b,c,d){var e=this;this.input=$(a).click(function(){return $("table.datetime").each(function(){e.container[0]!==this?$(this).hide():e.show()}),!1}),this.auto_show=b||!1,this.only_date=c||!1,this.only_time=d||!1,this.readDateTime(),this.container=$('<table class="datetime"></table>').click(function(){return!1}),b?this.container.hide().addClass("auto_show"):this.input.hide();var f=$("<tr></tr>").appendTo(this.container);this.calendar=$("<td></td>").appendTo(f),this.timetable=$("<td></td>").appendTo(f),this.drawDate(this.currentYear,this.currentMonth),this.drawTimetable(),c&&(this.timetable.hide(),this.currentTime="00:00:00"),d&&this.calendar.hide(),this.input.after(this.container)},show:function(){this.readDateTime(),this.container.css({position:"absolute",left:this.input.offset().left}).show(),this.only_date&&(this.timetable.hide(),this.currentTime="00:00:00"),this.only_time&&this.calendar.hide()},readDateTime:function(){var a=this,b=function(b,c,d,e){a.currentYear=parseInt(b,10),a.currentMonth=parseInt(c,10),a.currentDay=parseInt(d,10),a.currentTime=e},c=/(\d{4})-(\d{1,2})-(\d{1,2}) (\d{2}):(\d{2}):(\d{2})/,d=this.input.val(),e=c.exec(d);if(""!=d&&e)b(RegExp.$1,RegExp.$2,RegExp.$3,[RegExp.$4,RegExp.$5,RegExp.$6].join(":"));else{var f=new Date;b(f.getFullYear(),f.getMonth()+1,f.getDate(),[f.getHours(),f.getMinutes(),f.getSeconds()].join(":"))}},writeDateTime:function(){this.input.val(this.currentYear+"-"+this.currentMonth+"-"+this.currentDay),this.only_date||this.input.val(this.input.val()+" "+this.currentTime),this.only_time&&this.input.val(this.currentTime)},drawTimetable:function(){var a=this,b=$('<table class="timetable"></table>').append($('<tr><th class="caption">Uhrzeit</th></tr>'));this.timetable.append(b);var c=new Date,d=[["Jetzt",[c.getHours(),c.getMinutes(),c.getSeconds()].join(":"),function(a){a.container.hide()}],["Mitternacht","00:00:00"],["6 Uhr","06:00:00"],["Mittag","12:00:00"],["18 Uhr","18:00:00"]];$.each(d,function(c,d){b.append($("<tr></tr>").append($("<td></td>").append($("<a/>").text(d[0]).click(function(){return a.currentTime=d[1],a.writeDateTime(),d.length>2&&d[2](a),!1}))))});var e=$("<td></td>").appendTo($("<tr></tr>").appendTo(b));this.auto_show&&$('<a class="close">Schließen</a>').click(function(){return a.container.hide(),!1}).appendTo(e)},drawCalendar:function(){var a=this,e=parseInt(this.calendarMonth,10),f=parseInt(this.calendarYear,10);this.calendar.children().remove();var g=$('<table class="calendar"></table>').append($("<tr></tr>").append($('<th colspan="7" class="caption"></th>').append($('<a class="calendarnav-next"></a>').text(">").click(function(){return a.drawNextMonth(),!1}),$('<a class="calendarnav-previous"></a>').text("<").click(function(){return a.drawPreviousMonth(),!1}),$("<span>"+c[e-1]+" "+f+"</span>").click(function(){$(this).hide().after($('<input type="text" />').val(e+"-"+f).change(function(){var b=/(\d{1,2})-(\d{1,2})-(\d+)/;if(b.exec($(this).val()),RegExp.$1)a.drawDate(RegExp.$3,RegExp.$2,RegExp.$1);else{var c=/(\d{1,2})-(\d+)/;c.exec($(this).val()),RegExp.$1&&a.drawDate(RegExp.$2,RegExp.$1)}}).keypress(function(a){return 13==a.keyCode?($(this).change(),!1):void 0}).blur(function(){$(this).change()})),$(this).next().focus()}).attr("title","Klicke hier, um schnell einen anderen Monat auszuwählen")))),h=$("<tbody></tbody>").appendTo(g),i=$("<tr></tr>").appendTo(h);$.each(d,function(a,b){i.append($('<th class="weekday"></th>').text(b))});for(var j=new Date(f,e-1,1).getDay(),k=b(e,f),i=$("<tr></tr>").appendTo(h),l=0;j>l;l++)$('<td style="background-color: #f3f3f3;"></td>').appendTo(i);for(var m=1,n=function(){return $(".selected",$(this).parent().parent().parent()).removeClass("selected"),$(this).parent().addClass("selected"),a.currentDay=$(this).text(),a.currentMonth=e,a.currentYear=f,a.writeDateTime(),!1},l=j;k>=m;l++){l%7===0&&1!=m&&(i=$("<tr></tr>").appendTo(h));var o=$("<td></td>").append($("<a></a>").text(m).click(n)).appendTo(i);f==this.currentYear&&e==this.currentMonth&&m==this.currentDay&&o.addClass("selected"),m++}for(;i.children().length<7;)i.append($('<td class="nonday"></td>'));this.calendar.append(g)},drawDate:function(a,b,c){c=parseInt(c,10),b=parseInt(b,10),a=parseInt(a,10),b>0&&13>b&&(this.calendarMonth=b,this.calendarYear=a,c&&(this.currentDay=c,this.currentMonth=b,this.currentYear=a),this.drawCalendar())},drawPreviousMonth:function(){1==this.calendarMonth?(this.calendarMonth=12,this.calendarYear--):this.calendarMonth--,this.drawCalendar()},drawNextMonth:function(){12==this.calendarMonth?(this.calendarMonth=1,this.calendarYear++):this.calendarMonth++,this.drawCalendar()},drawPreviousYear:function(){this.calendarYear--,this.drawCalendar()},drawNextYear:function(){this.calendarYear++,this.drawCalendar()},destroy:function(){this.writeDateTime(),this.container.remove(),this.input.show()}}),$(document).ready(function(){$("input").each(function(){var a=this.getAttribute("valuetype");"datetime"==a?DateTimeField(this,!0):"date"==a?DateTimeField(this,!0,!0):"time"==a&&DateTimeField(this,!0,!1,!0)})}),$(document).click(function(){$("table.datetime.auto_show").hide()})}();