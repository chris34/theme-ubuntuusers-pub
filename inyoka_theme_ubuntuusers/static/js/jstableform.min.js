/**
 * Inyoka ubuntuusers.de theme
 * 2015-01-03 17:12:45
 * https://github.com/inyokaproject/theme-ubuntuusers
 * :copyright: (c) 2007-2015 by the Inyoka Team
 * :license: BSD
 */
$(function(){!function(){JSTableForm=function(a,b){function c(a){a.addClass("jstableform-status-no").removeClass("jstableform-status-yes")}function d(a){a.addClass("jstableform-status-yes").removeClass("jstableform-status-no")}function e(){switch(f($(this))){case!0:c($(this));break;case!1:d($(this))}}function f(a){return a.hasClass("jstableform-status-yes")?!0:a.hasClass("jstableform-status-no")?!1:null}function g(a){return q.test(a)}function h(a){return r.test(a)}function i(a){return s.test(a)}function j(a){return t.test(a)}function k(){var a=$(this).parent().attr("name").substring(16),b=y[a].validator;null!=b&&(b($(this).val())?$(this).removeClass("invalid"):$(this).addClass("invalid"))}function l(b){b.preventDefault();var c=$('<tr name="jstableform-_new"></tr>');$.each(z,function(a,b){var d,f=y[b],g=$('<td name="jstableform-key-'+b+'"></td>');"string"==f.type||"int"==f.type||"float"==f.type?(d=$('<input type="text"/>'),d.blur(k),d.appendTo(g)):"text"==f.type?(d=$("<textarea></textarea>"),d.blur(k),d.appendTo(g)):"boolean"==f.type?(g.addClass("jstableform-status-no"),g.addClass("pointer"),g.click(e)):"_edit"==f.type||"_delete"==f.type&&(d=$('<a href="#'+w+'">Löschen</a>'),d.click(m),d.appendTo(g)),g.appendTo(c)}),$("tbody",a).append(c)}function m(a){a.preventDefault(),$(this).parent().parent().remove()}function n(a){a.preventDefault();var b=$(this).parent().parent(),e=b.attr("name").substring(12);$.each(z,function(a,f){var g=y[f],h=b.find('[name="jstableform-key-'+f+'"]');if("string"==g.type||"int"==g.type||"float"==g.type||"text"==g.type)h.empty(),h.text(u[e][f]);else if("boolean"==g.type)u[e][f]?d(h):c(h),h.unbind("click"),h.removeClass("pointer");else if("_edit"==g.type){var i=$('<a href="#'+w+'">Ändern</a>');h.empty(),i.click(o).appendTo(h)}else"_delete"==g.type}),delete u[e],delete v[e]}function o(a){a.preventDefault();var b=$(this).parent().parent(),c=b.attr("name").substring(12),d={};$.each(z,function(a,c){var g=y[c],h=b.find('[name="jstableform-key-'+c+'"]');if("string"==g.type||"int"==g.type||"float"==g.type){var i=$('<input type="text"/>');i.blur(k),d[c]=h.text(),i.val(h.text()),h.empty(),i.appendTo(h)}else if("text"==g.type){var i=$("<textarea></textarea>");i.blur(k),d[c]=h.text(),i.val(h.text()),h.empty(),i.appendTo(h)}else if("boolean"==g.type)d[c]=f(h),h.addClass("pointer"),h.click(e);else if("_edit"==g.type){var i=$('<a href="#'+w+'">Abbrechen</a>');h.empty(),i.click(n),i.appendTo(h)}else"_delete"==g.type}),u[c]=d,v[c]=!0}function p(a){var c,d,e=new Array;$('tr[name^="jstableform-"]').each(function(){c=$(this);var b=c.attr("name").substring(12);d="_new"==b;var g={};d||v[b]?$.each(z,function(b,d){var e=y[d],h=c.find('[name="jstableform-key-'+d+'"]');if("string"==e.type||"int"==e.type||"float"==e.type||"text"==e.type){var i=$("input",h),j=i.val(),k=!0;null!==e.validator&&(k=e.validator(j)),k||a.preventDefault(),g[d]=j}else"boolean"==e.type&&(g[d]=f(h))}):$.each(z,function(a,b){var d=y[b],e=c.find('[name="jstableform-key-'+b+'"]');"string"==d.type||"int"==d.type||"float"==d.type||"text"==d.type?g[b]=e.text():"boolean"==d.type&&(g[b]=f(e))}),e.push(g)}),b.val(window.JSON.stringify(e))}var q=/^\d+$/,r=/^\d+|\d+\.\d+|\.\d+$/,s=/^\d\d?\.\d\d$/,t=/^[A-Z][a-z]+ [A-Z][a-z]+$/,u={},v={},w=a.attr("id")||"",x={"int":g,"float":h,versionnumber:i,versionname:j},y={},z=[];$('td[class="jstableform-_jswarning"]',a).parent().remove(),$("thead tr td",a).each(function(){classes=$(this).attr("class").split(" ");var a,b={key:null,type:null,validator:null};$.each(classes,function(c,d){if(0==d.indexOf("jstableform-"))if(d=d.substring(12),0==d.indexOf("key-")){if(a=d.substring(4),b.key=a,"_cmdedit"==a)return b.type="_edit",!0;if("_cmddel"==a)return b.type="_delete",!0}else 0==d.indexOf("type-")?(b.type=d.substring(5),"int"==b.type&&null==b.validator?b.validator=x["int"]:"float"==b.type&&null==b.validator&&(b.validator=x["float"])):0==d.indexOf("validate-")&&(b.validator=x[d.substring(9)])}),y[a]=b,z.push(a)}),$('a[name="jstableform-add"]',a).click(l),$('td[name|="jstableform-key-_cmdedit"] a',a).click(o),$('td[name|="jstableform-key-_cmddel"] a',a).click(m),$('input[type="submit"]').click(p)}}()});